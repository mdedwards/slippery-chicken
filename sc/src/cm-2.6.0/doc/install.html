<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta content="text/html; charset=iso-8859-1"
 http-equiv="content-type"/>
  <style media="all" type="text/css">
@import "css/cm.css";
  </style>
  <title>Installing Common Music</title>
</head>
<body>
<!-- Navbar -->
<div id="header">
<div id="logo"><img title="" alt="[img/cmlogosw.png]" height="50"
 width="50" src="img/cmlogosw.png"/>
</div>
<div class="inv">Navigation:</div>
<ul class="nav">
  <li class="nav1"><a href="cm.html">Home Page</a></li>
  <li class="navn"><a href="dict/">Dictionary</a></li>
  <li class="navn"><a href="../etc/examples/">Examples</a></li>
</ul>
</div>
<hr class="inv"/>
<div id="content">
<h1>Installing Common Music</h1>
<p>
Installing Common Music involves downloading the sources, starting a
<a href="cm.html#implementations">supported Lisp implementation</a>,
loading CM's sources and (optionally) saving a Lisp image file
containing the application. Once the system is installed you can <a
href="emacs.html">run Common Music in X/Emacs</a> and load in
additional software systems such as <a
href="http://www-ccrma.stanford.edu/software/clm/">CLM</a>, <a
href="http://www-ccrma.stanford.edu/software/cmn/">CMN</a> and <a
href="http://www.grame.fr/MidiShare/">Midishare</a>.
</p>
<h2>Contents</h2>
<ol>
  <li><a href="#restore_src">Downloading and restoring the sources</a>
    <ol>
      <li><a href="#restore_tar">Restoring sources from archives</a></li>
      <li><a href="#restore_cvs">Restoring sources from CVS</a></li>
    </ol>
  </li>
  <li><a href="#start_lisp">Starting a Lisp application</a></li>
  <li>
    <a href="#load_cm">Loading Common Music</a>
    <ol>
      <li><a href="#load_shell">Quickstart (OS X, Linux or Cygwin)</a></li>
      <li><a href="#load_lisp">Lisp loading</a></li>
      <li><a href="#load_custom">Saving images and other custom builds</a></li>
    </ol>
  </li>
  <li><a href="#configure_gtk">Configuring GTK</a></li>
    <ol>
<li><a href="#gtk_darwin">Configuring X11 and GTK2 on Darwin (OS X)</a></li>
<li><a href="#gtk_openmcl">Installing GTK2 support in OpenMCL (OS X)</a></li>      
<li><a href="#gtk_sbcl">Adding callback support to SBCL (Linux)</a></li>
</ol>

     
  <li><a href="#install_sys">Working with CLM, CMN and MidiShare</a>
    <ol>
      <li><a href="#install_clm_cmn">Loading CLM and CMN</a></li>
      <li><a href="#install_ms">Installing Midishare</a></li>
    </ol>
  </li>
  <li><a href="#troubleshooting">Troubleshooting</a>
    <ol>
      <li><a href="#trouble_eol">End-of-line conversion (MacOS)</a></li>
      <li><a href="#trouble_unpack">Installation directory not restored (Windows)</a></li>
      <li><a href="#clisp.bat">Installing a CLISP command on Windows</a></li>
      <li><a href="#trouble_dosdir">The DOS directory character in Lisp</a></li>
    </ol>
  </li>
</ol>
<h2 id="restore_src">1. Downloading and restoring the sources</h2>
<p>
Common Music's sources can be downloaded from archives or via
anonymous CVS. <!-- Although the CVS tree contains the most up-to-date
version of the system, these sources represent the "bleeding edge" of
development and may include bugs and untested features. -->
</p>
<h3 id="restore_tar">1.1 Restoring sources from archives</h3>
<ol>
<li>
<p>
Download the latest CM source archive from the <a
 href="http://www.sf.net/projects/commonmusic">Sourceforge Common
 Music Project</a>.
</p>
</li>

<li>
<p>
Place the downloaded archive in an appropriate directory on your
machine. If you are going to work with other Lisp packages such as <a
href="http://www-ccrma.stanford.edu/software/clm/">CLM</a> or <a
href="http://www-ccrma.stanford.edu/software/cmn/">CMN</a> you might
consider creating a parent Lisp directory to restore these different
Lisp systems in.
</p>
</li>
<li>
<p>
Restore the CM source archive with whatever software you use. This
should unpack the contents of the archive in a directory named
cm-<em>n.n.n</em>, where <em>n.n.n</em> is the version number of the
CM release. This document will refer to this directory as the <em>CM
installation directory</em>.
</p>
</li>
</ol>

<h3 id="restore_cvs">1.2 Restoring sources from <a
href="https://www.cvshome.org/docs/manual/cvs-1.12.10/cvs.html#SEC_Top">CVS</a></h3>

<p>
The sources to Common Music are maintained in a CVS repository
organized into different <em>release branches</em> that
are <em>tagged</em> by symbolic release numbers.  By convention, even
numbered branches denote stable software release lines and odd
numbered branches denote <em>unstable</em>, or developmental,
releases.  The CVS <em>head branch</em> &#8212; the release branch you
get if you do not specify any release tag &#8212; always points to the
latest developmental sources.
</p>

<p>
As of this date (November 2004), Common Music's CVS tree has two main
branches: a <code>rel-2_4</code> branch line contains sources and bug
fixes to the stable 2.4.<em>n</em> releases; CM's head branch
points to the 2.5.<em>n</em> developmental line.
</p>

<p>
To check out sources from Common Music's CVS repository use
the Unix <code>cvs</code> command or a CVS client
application. Downloading sources for the first time is accomplished in
two steps: (1) logging in to the Sourceforge CVS server in anonymous
mode and (2) checking out the sources to the desired release branch.
</p>

<p>
Directions for checking out sources from CM's repository at Sourceforge:
</p>

<ol>

<li>
<p>
Change directories to the parent directory in which you want to
install the CM source tree.
</p>
</li>

<li>
<p>
Use <a href="https://www.cvshome.org/docs/manual/cvs-1.12.10/cvs_2.html#SEC31">anonymous CVS login</a> to the <a
 href="http://sourceforge.net/cvs/?group_id=9766">Sourceforge CVS
 repository</a>. Press the Return key when prompted for a login password:
</p>

<pre class="shell">
$ <span class="input">CVSROOT=":pserver:anonymous@cvs.sourceforge.net:/cvsroot/commonmusic"</span> 
$ <span class="input">cvs login</span>
CVS password:
$</pre>
</li>

<li>
<p>
Use the <a
href="https://www.cvshome.org/docs/manual/cvs-1.12.10/cvs_16.html#SEC136">CVS
checkout command</a> to restore the CM source tree to your computer.
</p>

<p>
To download the latest (developmental) sources from the head branch:
</p>
<pre class="shell">
$ <span class="input">cvs checkout -P cm</span>
<span class="comment">[cvs printout omitted...]</span></pre>

<p>
To check out a stable release, specify the appropriate tag to the
checkout command. For example, to get the latest stable version on the
CM 2.4.<em>n</em> release line do:
</p>

<pre class="shell">
$ <span class="input">cvs checkout -P -r rel-2_4 cm</span>
<span class="comment">[cvs printout omitted...]</span></pre>
<p>
Once the source tree has been restored to your machine you can cd inside it
and use the <a href="dict/cm-sh.html">cm.sh</a>
script to build CM:
</p>
<pre class="shell">
$ <span class="input">cd cm</span>
$ <span class="input">bin/cm.sh</span>
<span class="comment">[build printout omitted...]</span></pre>
</li>

<li>
<p>
Once you have checkout the sources you do not need to use the login or
checkout command again. To remain current with a release line you
simply cd to your CVS source tree and use the <a
href="https://www.cvshome.org/docs/manual/cvs-1.12.10/cvs_16.html#SEC170">CVS
update command</a> to update your installation tree with the newest
versions of the files from the repository. Then use the <a
href="dict/cm-sh.html">cm.sh</a> script to recompile and reload CM:
</p>

<pre class="shell">
$ <span class="input">cd /path/to/cm</span>
$ <span class="input">cvs update</span>
<span class="comment">[cvs printout omitted...]</span>
$ <span class="input">bin/cm.sh</span>
<span class="comment">[build printout omitted...]</span></pre>
</li>
</ol>

<h2 id="start_lisp">2. Starting the Lisp application</h2>
<p>
In order to build Common Music from its sources you must be able to
start one of the
<a href="cm.html#implementations">supported Lisp implementations</a>.
Each Lisp may be represented by (up to) three implementation files:
</p>

<ol>
<li>
<p>
A <em>shell command</em> or program that starts Lisp running in
a Terminal (the CMD window on Windows) or under <a
href="emacs.html">X/Emacs</a>.
</p>
</li>
<li>
<p>
An installed executable that runs when the command is
invoked.
<p>
</li>
<li>
<p>
An <em>image file</em> that contains the Lisp runtime
environment.
<p>
</li>
</ol>

<p>
The following table lists the commands, programs and image names for
each Lisp implementation. Follow the links for additional information.
</p>

<div class="float">
<p class="captxt">Application files for supported Lisp
implementations.
</p>
<table class="float">
  <tbody>
    <tr>
      <th style="padding-right: 1em; text-align: left;" class="col">Lisp</th>
      <th style="padding-right: 1em; text-align: left;" class="col">Command</th>
      <th style="text-align: left;" class="col">Executable</th>
      <th style="text-align: left;" class="col">Image</th>
 </tr>
    <tr>
      <td><a href="http://cvs.sourceforge.net/viewcvs.py/clisp/clisp/INSTALL?view=markup">CLISP</a></td>
      <td><a href="http://clisp.cons.org/clisp.html"><code>clisp</code></a></td>
      <td>./full/lisp(.exe) </td>
      <td>./full/lispinit.mem</td>
    </tr>
    <tr>
      <td><a href="http://www.cons.org/cmucl/install.html">CMU</a></td>
      <td><a href="http://www.pmsf.de/pub/cmucl/doc/cmu-user/introduction.html#toc2"><code>lisp</code></a></td>        
      <td>./bin/lisp </td>
      <td>./lib/cmucl/lib/lisp.core</td>
    </tr>
    <tr>
      <td><a href="http://openmcl.clozure.com/Doc/installation.html">OpenMCL</a></td>
      <td>
        <a href="http://openmcl.clozure.com/Doc/shell-script.html"><code>openmcl</code></a>
      </td>
      <td>./dppccl </td>
      <td>./dppccl.image</td>
    </tr>
    <tr>
      <td><a href="http://www.franz.com/support/documentation/6.1/doc/startup.htm">ACL</a></td>
      <td> </td>
      <td>./alisp(.exe) </td>
      <td>./lisp.dxl</td>
    </tr>
    <tr>
      <td><a
      href="http://www.gnu.org/software/guile/docs/guile-ref/Obtaining-and-Installing-Guile.html#Obtaining%20and%20Installing%20Guile">Guile</a></td>
      <td><a
      href="http://www.gnu.org/software/guile/docs/guile-ref/Invoking-Guile.html#Invoking%20Guile"> <code>guile</code></a></td> <td>guile</td> <td></td>
    </tr>
  </tbody>
</table>
</div>

<p>
If you are on OS X, Linux or Cygwin you can use the <code>which</code>
command to see if a Lisp command is installed properly on your path.
</p>

<div class="float">
<p class="captxt">Using 'which' to locate a lisp command (Linux, OS X, Cygwin).</p>
<pre class="shell">$ <span class="input">which clisp</span>
/usr/local/bin/clisp
$ <span class="input">which openmcl</span>
/Lisp/bin/openmcl
$ <span class="input">which guile</span>
/sw/bin/guile
$ <span class="input">which alisp</span>
alisp: Command not found.</pre>
</div>

<p>
<em>Even if your Lisp implementation does NOT come with an installed
command you should create and install one to simplify working with
Common Music</em>. There is not one single way to do this that will
work for all Lisp implementations and operating systems.  On OS X,
Linux or Cygwin, either copy the appropriate Lisp program/script to a
directory on your $PATH or edit your $PATH definition in
~/.bash_profile or ~/.cshrc to include the directory that contains the
Lisp program/script. On Windows 2000/XP install a batch file to start
CLISP, see <a href="#clisp.bat">clisp.bat</a> for information on how
to do this. On MacOS, double-click the MCL Common Lisp application to
start Lisp.
</p>

<h2 id="load_cm">3. Loading Common Music</h2>
<p>
The following instructions assume you can start Lisp by typing
the appropriate command in a Terminal window. The examples depict the
load process in several different Lisp implementations; if you use
some other Lisp or operating system the examples will appear slightly
differently as you perform each step.
</p>
<h3 id="load_shell">3.1 Quickstart (OS X, Linux or Cygwin)</h3>

<p>
The easiest way to load CM on OS X, Linux or Cygwin is with
the <a href="dict/cm-sh.html"><code>cm.sh</code></a> script located in the bin/ subdirectory of the
CM installation directory. When the script finishes loading it will
leave you in the CM package ready to begin work:
</p>

<div class="float">
<p class="captxt">Running the <code>cm.sh</code> script.
</p>
<pre class="shell">$ <span class="input">cd /path/to/cm</span>
$ <span class="input">bin/cm.sh</span>
<span style="color: gray; font-style: italic;">[...build output omitted...]</span>

 /\\\          
---\\\---------
----\\\--------
----/\\\------- Common Music 2.5.0
---/--\\\------
--/----\\\-----
 /      \\\/   
?</pre>
</div>

<p>
The <code>cm.sh</code> script can run CM in a Terminal or under
<a href="emacs.html">X/Emacs</a>.  Type <code>cm.sh -h</code> for an
overview of the script's command options and usage.
</p>

<h3 id="load_lisp">3.2 Lisp loading</h3>

<p>
The cm.sh script is used to start CM running from inside the Unix
terminal. If you inside a Lisp application you can load Common Music's
build script from the src/ subdirectory of the CM installation
directory. For Scheme the build script is called cm.scm, for all
Common Lisp implementations the file to load is called cm.lisp. Be
sure to specify the full, true pathname to the file, i.e. avoid using
links, relative paths, or shortcuts like "~/" unless you are sure your
Lisp supports them.
</p>

<div class="float">
<p class="captxt">Loading CM in Common Lisp.</p>
<pre class="shell">? <span class="input">(load "/path/to/cm/src/cm.lisp")</span>
<span style="color: gray; font-style: italic;">[...build output omitted...]</span></pre>
</div>
<div class="float">

<p class="captxt">Loading CM in Scheme.</p>
<pre class="shell">guile&gt; <span class="input">(load "/path/to/cm/src/cm.scm")</span>
<span style="color: gray; font-style: italic;">[...build output omitted...]</span>
</pre>

</div>
<div class="float">
<p class="captxt">Loading CM in Clisp/Windows (Common Lisp).
</p>
<pre class="shell">[1]&gt; <span class="input">(load "c:\\path\\to\\cm\\src\\cm.lisp")</span>
<span style="color: gray; font-style: italic;">[...build output omitted...]</span></pre>
</div>

<p>
For information about using the DOS directory character in Lisp see <a
href="#trouble_dosdir">Troubleshooting Tip 4</a>.
</p>

<p>
Loading cm.scm into Guile (Scheme) loads CM's source files &#8212; no
compilation or image saving occurs. In in all other Lisp
implementations loading cm.lisp first <em>compiles</em> source files
into an efficient (binary) representation and then loads them into
Lisp.
</p>

<p>
Once the load process completes you can switch to the CM package using
the <code>cm</code> function. This will allow you to easily access all
the symbols and functions defined in Common Music. Use
the <code>quit</code> function to exit from Common Music and Lisp.
</p>

<div class="float">
<p class="captxt">Switching to the CM package.</p>
<pre class="shell">? <span class="input">(cm)</span>

 /\\\          
---\\\---------
----\\\--------
----/\\\------- Common Music 2.5.0
---/--\\\------
--/----\\\-----
 /      \\\/   

? <span class="input">(quit)</span></pre>
</div>
<h3 id="load_custom">3.3 Saving Lisp images and other custom builds</h3>
<p>
A Lisp <em>image file</em> containing Common Music can be saved in
CM's binary directory. Despite the fact that a saved image file may
boot a few seconds faster than loading CM from compiled files, fasl
loading is the preferred method for starting CM because it provides
more flexibility for working with different Lisp systems together.
</p>

<ol>
  <li>
<p>
To save a Lisp image file, start Lisp and then load make.lisp from the
src/ subdirectory. Then call the <a
href="dict/make-cm-fn.html">make-cm</a> function with :save-image specified:
</p>

<pre class="shell">? <span class="input">(load "/path/to/cm/src/make.lisp")</span>
; Loading /path/to/cm/src/make.fasl
? <span class="input">(make-cm :save-image t)</span>
<span class="comment">[...build output omitted...]</span>
; Removing fasl files.
; Garbage collecting...
; Saving application image.
; Bye!
$</pre>
</li>

<li>
<p>
Once the system loads and saves an image you will automatically exit
Lisp. You can then start your freshly saved Common Music image using
the <a href="dict/cm-sh.html">cm.sh</a> script or by specifying the
image file to your Lisp command according to its installation
directions.
</p>
</li>
</ol>


<p>
See the documentation on <a href="dict/make-cm-fn.html">make-cm</a>
for more information about the various build options.
</p>


<h2 id="configure_gtk">4. Configuring GTK</h2>

<p>
CM's graphics support is implemented in <a
href="http://www.gtk.org">GTK2</a>, a popular graphics library that
can be used with CM in the following Lisp environments:
<ul>
<li>PPC/Darwin: OpenMCL 0.14.1-p1 or higher</li>
<li>x86/Linux: SBCL 0.8.17 or higher</li>
<li>x86/Linux: CMUCL 19a or higher</li>
</ul>

<p>
CM's Lisp-to-GTK interface is implemented using <a
href="http://common-lisp.net:/project/lambda-gtk/lambda-gtk.html">&lambda;gtk</a>,
a separate software package developed by the author and made available
under the LLGPL (Lisp Lesser General Public License).
</p>

<p>
CM will automatically include its GUI tools in any correctly
configured and supported environment. If you use either OpenMCL on
Darwin or SBCL on Linux then you may have to configure your
environment before you attempt to build CM with its GUI.
</p>

<h3 id="gtk_darwin">4.1 Configuring X11 and GTK2 on Darwin (OS X)</h3>

<p>
You must have X11 and GTK2 installed and configured properly on your
machine. Apple's X11 application must also be running before you can
open any windows.
</p>

<ol>

<li>
<p>
X11.app normally resides in /Application/Utilities/. If you do not
have it you can download it from <a
href="http://www.apple.com/macosx/features/x11/download/">Apple's X11
page</a>. It should also be possible to use <a
href="http://www.xdarwin.org/"> XDarwin/XFree86</a> but I have not
tried it.
</p>
</li>

<li>
<p>
Use <a href="http://finkcommander.sourceforge.net">FinkCommander</a>
to install Fink's <a
href="http://fink.sourceforge.net/pdb/package.php/gtk+2">gtk+2</a>
package. CM assumes that all GTK+ libraries are restored under
/sw/lib/ directory (the default location for installing Fink
packages).
</p>
</li>
</ol>

<p>
Once X11 and GTK2 are installed and the X11.app is running you can
open a GUI window inside cm running in xterm or under XEmacs.  You can
also start GTK windows from inside Terminal.app or <a
href="emacs.html#downloading">Emacs.app</a> (the Cocoa Emacs
application) if you add the following line to your ~/.bash_profile
file:
</p>

<blockquote>
<pre>export DISPLAY=:0.0</pre>
</blockquote>

<p>
It has been noticed on some networked OSX computers that opening the
first GTK window inside Lisp takes over a minute to complete. The
problem is related to font loading but I have not yet been able to
determine exactly what is going wrong. If you encounter this problem
the (temporary) fix is to add the following line to your
~/.bash_profile file:
</p>

<blockquote>
<pre>export GDK_USE_XFT=0</pre>
</blockquote>

<h3 id="gtk_openmcl"> 4.2 Installing GTK2 support in OpenMCL (OS X)</h3>

<p>
In order to work with GTK2 in OpenMCL you must first install a foreign
function interface (FFI) to the GTK libraries:
<ol>

<li>
<p>
Download <a

href="http://pinhead.music.uiuc.edu/~hkt/openmcl-darwin-ffi-gtk2.tar.gz">openmcl-darwin-ffi-gtk2.tar.gz</a>
</p>
</li>

<li>
<p>
Untar the archive inside your ccl/darwin-headers/ directory under the
OpenMCl distribution:
</p>
<pre class="shell">$ <span class="input">cd /path/to/ccl/darwin-headers</span>
$ <span class="input">tar -zxf openmcl-darwin-ffi-gtk2.tar.gz</span></pre>
</li>
</ol>

<h3 id="gtk_sbcl"> 4.3 Adding callback support to SBCL (Linux)</h3>
<p>
As of this date (Feb '05) SBCL does not provide a native callback
facility. Unless you are certain that callbacks exist in your version
of SBCL you will need to install Thomas Burdick's SBCL callback
package and save a new SBCL core image before you build CM:
</p>

<ol>
<li>
<p>
Download <a
href="http://pinhead.music.uiuc.edu/~hkt/sbcl-af-2004-10-22.tgz">Thomas
Burdick's Alien Function package</a> and restore it to a directory on
your machine.
</p>
</li>
<li>
<p>
Compile the Alien Function package and save a new sbcl.core image:
</p>

<pre class="shell">$ <span class="input">cd sbcl-af</span>
$ <span class="input">sbcl --load "system"</span>
* <span class="input">(sb-ext:save-lisp-and-die "/tmp/sbcl.core")</span>
$ <span class="input">cd /usr/local/lib/sbcl</span>
$ <span class="input">mv sbcl.core sbcl.core.orig</span>
$ <span class="input">mv /tmp/sbcl.core .</span></pre>
</li>

</ol>


<h2 id="install_sys">5. Working with CLM, CMN and Midishare</h2>

<p>
You can load other Lisp software systems into Lisp either before or
after loading Common Music.  If you want to save a Lisp image
containing all of these systems bundled together, load the other
software before you call <code>make-cm</code> to save the image.
</p>

<h3 id="install_clm_cmn">5.1 Loading CLM and CMN</h3>
<p>
To work with either CLM or CLM you simply load the system using the 
appropriate command shown below:
</p>

<div class="float">
<p class="captxt">Loading CLM and CMN into the CM package.</p>
<pre class="shell">? <span class="input">(load "/path/to/clm-2/all")</span>
<span class="comment">[build output omitted...]</span>
? <span class="input">(load "/path/to/cmn/cmn-all")</span>
<span class="comment">[build output omitted...]</span></pre>
</div>

<p>
Note that if you load CLM instruments that were compiled outside of
the Common Music package you will have to <code>import</code> their
symbols before working with the instruments:
</p>

<div class="float">
<p class="captxt">
Importing instruments compiled in the cl-user package.
</p>

<pre class="shell">? <span class="input">(load "/path/to/clm-2/v")</span>
#P"/path/to/clm-2/v.dfsl"  
? <span class="input">(load "/path/to/clm-2/grani")</span>
#P"/path/to/clm-2/grani.dfsl"
? <span class="input">(import '(cl-user::fm-violin cl-user::grani))</span>
T
? <span class="input">(new fm-violin :startime 0 :dur 3 :frequency 440)</span>
#i(fm-violin startime 0 dur 3 frequency 440)</pre>
</div>

<h3 id="install_ms">5.2 Installing Midishare</h3>
<p>
A direct connection from Common Music to one or more MIDI Drivers can
be established using <a
href="http://www.grame.fr/MidiShare/">Midishare</a>, a real-time MIDI
operating system developed by <a href="http://www.grame.fr">Grame</a>.
Common Music currently works with Midishare in the following OS/Lisp
combinations:
</p>
<ul>
  <li>Linux/CMUCL</li>
  <li>OS X/OpenMCL</li>
  <li>OS X/MCL 5.0</li>
  <li>MacOS 9.2/MCL 4.2, 4.3</li>
</ul>

<p>
Directions for installing MidiShare:
</p>

<ol>
<li>
<p>
Download, install and configure the Midishare and Developer packages
from the <a href="ftp://ftp.grame.fr/pub/MidiShare/">Midishare FTP
Server</a>. Be sure to set up your MidiShare driver ports (msDriver)
and test your MIDI connection (msController) before attempting to
build CM with Midishare.
</p>
</li>

<li>
<p>
If you are running OpenMCL, download <a
 href="ftp://ftp-ccrma.stanford.edu/pub/Lisp/cm/openmcl-midishare.tar.gz">openmcl-midishare.tar.gz</a>
 from the CCRMA ftp server and untar the archive in
 "ccl/darwin-headers/", i.e. the "darwin-headers/" subdirectory of
 your OpenMCL distribution:
</p>

<pre class="shell">$ <span class="input">cd /path/to/ccl/darwin-headers</span>
$ <span class="input">tar -zxf openmcl-midishare.tar.gz</span></pre>
</li>

<li>
<p>
Load the Midishare-Interface.lisp file located in the
src/MidiShare/ sub-folder
of the Common Music installation directory:
</p>
<pre class="shell">? <span class="input">(load "/path/to/cm/src/midishare/Midishare-Interface")</span></pre>
</li>

<li>
<p>
Once the file is load you can output MIDI events to the "midi.port"
destination.
<pre class="shell">? <span class="input">(events (new midi :time 0 :duration 2 :keynum 60) "midi.port")</span>
"midi.port"</pre>
</li>
</ol>

<p>
See the main <a href="dict/midi-topic.html">MIDI documentation</a> in
the dictionary for more information about MIDI and working with
MidiShare in real time.
</p>

<h2 id="troubleshooting">6. Troubleshooting</h2>
<dl>
  <dt id="trouble_eol">1. Line conversion (MacOS)</dt>
  <dd>Some installers on MacOS may not restore gzipped Unix tar files
(*.tar.gz), correctly. Make sure that your installer performs
end-of-line conversion on text files when it unpacks the sources. You
can determine if this was done correctly by editing CM's <a
 href="../readme.text">readme.text</a> using SimpleText. If the file is
legible then your installer performed the conversion correctly.
  </dd>
  <dt id="trouble_unpack">2. Installation directory not restored
(Windows)</dt>
  <dd>Some installers on Windows may choose to ignore the archive's
top-level directory if you unpack by double-clicking the file. These
steps work for me using WinZip:
    <ol>
      <li>Place the archive in the parent directory that will hold the
CM
distribution.</li>
      <li>Right-button the archive file and choose "Install Here" from
the
pop-up menu.</li>
    </ol>
  </dd>
  <dt id="clisp.bat">3. Installing a CLISP command (Windows)</dt>
  <dd>When Clisp is installed on Windows it places a <em>shortcut</em>
to the program on your desktop. Unfortunately, this shortcut is not
very useful for working with Common Music or for running Clisp under
Emacs. Here is how to install a CLISP command on Windows 2000:
    <ol>
      <li>Copy the contents of the script file shown below and paste
it into a new window in Note Pad.</li>
      <li>Change the pathname in green to the actual path to CLISP on
your machine.</li>
      <li>Save the text in a file called "clisp.bat".</li>
      <li>Move the new clisp.bat file to some directory on your path,
for
example to C:\WINNT\System32\clisp.bat.</li>
    </ol>
    <div class="float">
    <p class="captxt">The clisp.bat script file for Windows 2000.</p>

    <pre class="code">@echo off<br/><br/><span style="color: blue;">REM Edit the clispdir pathname inside "" to point to</span>
<span style="color: blue;">REM the clisp installation directory on your machine.</span>

<span style="color: red;">set</span> clispdir="<span
 style="color: green;">\Lisp\clisp-2.31</span>"<br/><span
 style="color: red;">pushd</span> %clispdir%<br/>.\full\lisp.exe -B . -M .\full\lispinit.mem %1 %2 %3 %4 %5 %6 %7 %8 %9<br/><span
 style="color: red;">popd</span></pre>
    </div>
  </dd>
  <dt id="trouble_dosdir">4. The DOS directory character in Lisp (Windows)
  </dt>
  <dd>You must double each DOS directory delimiter when you specify
Window's
directories in Lisp strings, i.e.
"c:\\lisp\\cm-2.5.0\\readme.text" <em>not</em>
"c:\lisp\cm-2.5.0\readme.text". This is because \ is a special
quoting character inside Lisp strings; specifying two together
actually produces one \ in the string. If this is too confusing then
you should simply switch to using the Unix-style directory delimiter /
on Windows, for example "c:/path/to/cm/readme.text". Allegro,
Clisp and Guile all support Unix-style directory strings under
Windows.
  </dd>
</dl>

<p>
<a href="http://validator.w3.org:8001/check?uri=referer">
<img src="http://www.w3.org/Icons/valid-xhtml10" 
     alt="Valid XHTML 1.0!" height="31" width="88" />
</a>
</p>
    
<!-- end content -->
</div>
<div id="footer">
<div id="author">H. Taube</div>
<div id="cvs-info">$Name: rel-2_6_0 $: $Source:
/cvsroot/commonmusic/cm/doc/install.html,v $ ($Revision: 1.32 $, $Date:
2003/12/18 18:07:13 $)</div>
</div>
</body>
</html>
